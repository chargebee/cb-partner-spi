---
stoplight-id: upohpgnjav634
---

## Chargebee -> SPI Adapter app
Chargebee uses [**HTTP header-based authorization**](https://datatracker.ietf.org/doc/html/rfc7235) for all SPI endpoints related to the Service Adapter. This approach ensures secure and dynamic management of authorization credentials during SPI interactions.

### How It Works
- The **Authorization Key** for API calls is dynamically passed in the HTTP header, enabling secure and seamless integration.
- This key is defined in the [JSON Schema](https://github.com/chargebee/cb-partner-spi/tree/einvoicing_spi_phase2/spec/capabilities), which must be completed and submitted by the partner during the app registration process in Chargebeeâ€™s Marketplace.
- During the application onboarding process in Chargebee, merchants provide the necessary authorization parameter values.
- The Chargebee application uses these values to authenticate and make API calls to the Service Adapter.


### Structure of `credential_configuration`
- The `credential_configuration` is an array of objects, where each object represents a credential parameter.
- Each object includes the following attributes:
    - **`id`**: A unique identifier for the credential. For example, `authorization_key` or `client_secret`.
    - **`name`**: A descriptive label of the credential.
    - **`type`**:The credential type. For example, `text`.
    - **`is_sensitive`**: Indicates whether the credential is sensitive.

### JSON Configuration Example

```json
{
  "api_configuration": {
    "api_base_url": "https://chargebee.partnerX.com/v1",
    "credential_configuration": [ 
      {
        "id": "api_key",
        "name": "API Key", 
        "type": "text",
        "is_sensitive": true 
      },
      {
        "id": "company_code",
        "name": "Company code",
        "type": "text",
        "is_sensitive": false
      }
    ]
  }
}
```

### Authorization Header

Below is the structure of authorization header that will be passed from Chargebee app to Service Adapter. Some of the 
parameters are sent by default by Chargebee as mentioned in the example below:

```bash
curl --request POST https://chargebee.partnerX.com/v1/endpoint \
  --header "Authorization: xxx" \
  --header "X-Merchant-Id: merchant_id_partnerX" \ //sent by Chargebee by default
  --header "X-Company-Code: company_code_partnerX" \ //sent by Chargebee by default
  --header "X-Trace-Id: 12345-abcde-67890" //sent by Chargebee by default
````

## SPI Adapter app -> Chargebee app

 For Partners, some endpoints are exposed by Chargebee such as `/webhooks/einvoicing-spi/{partner-id}/document_status` are designed to be called by the partner-hosted adapter. These endpoints require authorization using **OAuth 2.0**.

### How It Works

- During onboarding, the Chargebee merchant authorizes the adapter through an OAuth 2.0 flow from the partner app.
- Once authorized, Chargebee issues an **access token** to the partner app.
- The adapter includes this token in the `Authorization` header when making API calls to Chargebee.


### Security Guidelines
- The adapter must store tokens securely and refresh them when they expire.
- The `{partner-id}` in the endpoint path must match the identity associated with the token.
- Requests without a valid token or with a mismatched partner identity will be rejected with a `401 Unauthorized`.
